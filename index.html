<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Розыгрыш Baboss</title>
    <script src="https://telegram.org/js/telegram-web-app.js?version=7.2"></script>
    <style>
        body { background: #000; color: #fff; font-family: Arial; display: flex; flex-direction: column; align-items: center; }
        .cards-container { height: 300px; overflow: hidden; position: relative; width: 200px; border: 2px solid gold; }
        .cards { position: absolute; top: 0; left: 0; transition: top 5s cubic-bezier(0.22, 0.92, 0.7, 1.0); }
        .card { height: 100px; background: #333; margin: 10px 0; text-align: center; line-height: 100px; border-radius: 10px; }
        .arrow { position: absolute; left: -50px; top: 50%; transform: translateY(-50%); border: 20px solid transparent; border-right-color: white; }
        #startButton { margin-top: 20px; padding: 10px; }
        #result { margin-top: 20px; font-size: 24px; }
    </style>
</head>
<body>
    <h1>Розыгрыш</h1>
    <div class="cards-container">
        <div class="arrow"></div>
        <div id="cards" class="cards"></div>
    </div>
    <button id="startButton">Запустить</button>
    <div id="result"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const participants = JSON.parse(urlParams.get('participants') || '[]');
        const draw_id = urlParams.get('draw_id') || 'unknown';

        const cardsDiv = document.getElementById('cards');
        const startButton = document.getElementById('startButton');
        const resultDiv = document.getElementById('result');

        // Генерация карточек (дублируем список для seamless скролла)
        const extendedParticipants = [...participants, ...participants, ...participants];
        extendedParticipants.forEach(id => {
            const card = document.createElement('div');
            card.className = 'card';
            card.textContent = `ID: ${id}`;
            cardsDiv.appendChild(card);
        });

        startButton.addEventListener('click', () => {
            startButton.disabled = true;
            const cardHeight = 120; // Высота карточки + margin
            const totalHeight = extendedParticipants.length * cardHeight;
            const randomIndex = Math.floor(Math.random() * participants.length);
            const stopPosition = (participants.length + randomIndex) * cardHeight; // Остановка в середине списка
            cardsDiv.style.top = `-${stopPosition}px`;

            setTimeout(() => {
                const winner = participants[randomIndex];
                resultDiv.textContent = `Победитель: ID ${winner}`;
                // Отправка результата боту (аналогично колесу, через sendData или API)
                window.Telegram.WebApp.sendData(JSON.stringify({ draw_id: draw_id, winner: winner }));
            }, 5000);
        });
    </script>
</body>
</html>
